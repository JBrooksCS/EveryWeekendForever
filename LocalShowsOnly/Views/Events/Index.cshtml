@*@model IEnumerable<LocalShowsOnly.Models.Event>*@
@model PaginatedList<LocalShowsOnly.Models.Event>


@{
    ViewData["Title"] = "Index";
}
    <div style="display:inline-flex !important; ">
        <h2>[SHOWS]</h2>

        @{
            var prevDisabled = !Model.HasPreviousPage ? "disabled" : "";
            var nextDisabled = !Model.HasNextPage ? "disabled" : "";
        }
        <a>@Model.PageIndex</a>
        <a asp-action="Index"
           asp-route-sortOrder="@ViewData["CurrentSort"]"
           asp-route-pageNumber="@(Model.PageIndex - 1)"
           asp-route-currentFilter="@ViewData["CurrentFilter"]"
           class="btn btn-default @prevDisabled"
           style="margin-left:30em;">
            < Previous
        </a>
        <a asp-action="Index"
           asp-route-sortOrder="@ViewData["CurrentSort"]"
           asp-route-pageNumber="@(Model.PageIndex + 1)"
           asp-route-currentFilter="@ViewData["CurrentFilter"]"
           class="btn btn-default @nextDisabled">
            Next >
        </a>

        @using (Html.BeginForm())
        {
            <p style="padding-left:2em;">
                @Html.TextBox("SearchString")
                <input class="search-btn" type="submit" value="Search" />
            </p>
        }
    </div>
<table class="table">
    <thead>
        <tr>
            <th>

            </th>
            <th>
                WHAT
            </th>
            <th>
                WHERE
            </th>
            <th>
                WHEN
            </th>
            <th>
                &nbsp
            </th>
            <th>
                &nbsp
            </th>
            <th>
                &nbsp
            </th>
            <th>
                &nbsp
            </th>



        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model)
        {
            //if (item.showtime >= DateTime.Now)
            //{
        <tr>
            <td>
                <img src="@Url.Content(item.photoURL)" style="max-height: 200px; max-width:200px; box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);" />
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.title)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.venue.venueName)
            </td>
            <td>
                @item.showtime.ToString("M/d/yy")
            </td>
            @{
                if (item.externalLink != null)
                {
                    <td>
                        <a href="@Html.DisplayFor(modelItem => item.externalLink)" target="_blank">Link</a>
                    </td>
                }
                else
                {
                    <td>
                        <p>
                            &nbsp
                        </p>
                    </td>
                }
            }
            @{ if (item.id == ViewBag.top)
                {
                    <td class="event-rsvp">
                        @Html.DisplayFor(modelItem => item.RSVPs.Count)&nbspgoing
                    </td>
                }
                else
                {
                    <td>
                        @Html.DisplayFor(modelItem => item.RSVPs.Count)&nbspgoing
                    </td>
                }
            }
            
            @{
                var parms = new Dictionary<string, string> {
                       {"showId", $"{@item.id}" },
                       {"pageNumber", $"{@Model.PageIndex}" }

                    };

                if (ViewBag.AttendingList != null && ViewBag.AttendingList.Contains(item.id))
                {

                    //asp-route-showId="@item.id
                    <td>
                        <form asp-action="RemoveAttendee" asp-controller="RSVPs" asp-all-route-data="parms">
                            <input class="btn btn-success" type="submit" name="not attending" value=" You're Going  " />
                        </form>
                    </td>
                }
                else
                {
                    <td>
                        <form asp-action="AddAttendee" asp-controller="RSVPs" asp-all-route-data="parms">
                            <input class="btn btn-outline-info" type="submit" name="attend" value="Click to Attend" />
                        </form>
                    </td>
                }
            }
            <td>
                @{

                    if (item.hostId == ViewBag.UserId)
                    {

                        <form>
                            <div class="btn-group-vertical">
                                <button type="submit" name="details" value="Details" formaction="/Events/Details/@item.id" formmethod="get" class="btn btn-dark">Details</button>
                                <button asp-action="Edit" asp-route-id="@item.id" class="btn btn-dark">Edit</button>
                                <button asp-action="Delete" asp-route-id="@item.id" class="btn btn-dark">Delete</button>
                            </div>
                        </form>
                    }
                    else
                    {
                        <form>
                            <div class="btn-group-vertical">
                                <button type="submit" name="details" value="Details" formaction="/Events/Details/@item.id" formmethod="get" class="btn btn-dark">Details</button>

                            </div>
                        </form>
                    }
                }



            </td>

        </tr>
                                //}
                            }
    </tbody>
</table>




